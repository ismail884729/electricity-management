<div class="transactions-container">
  <div class="section-header">
    <h2>Your Transactions</h2>
    <div class="transaction-actions">
      <div class="search-bar">
        <input type="text" placeholder="Search by ID, reference, or amount..." [(ngModel)]="searchText" (keyup)="filterTransactions()">
      </div>
      <div class="filters">
        <button [class.active]="statusFilter === 'all'" (click)="setStatusFilter('all')">All</button>
        <button [class.active]="statusFilter === 'Completed'" (click)="setStatusFilter('Completed')">Completed</button>
        <button [class.active]="statusFilter === 'Pending'" (click)="setStatusFilter('Pending')">Pending</button>
        <button [class.active]="statusFilter === 'Failed'" (click)="setStatusFilter('Failed')">Failed</button>
      </div>
      <button class="refresh-btn" (click)="refreshTransactions()" [disabled]="isLoading">
        <span class="icon">🔄</span> Refresh
      </button>
    </div>
  </div>

  <div class="transactions-content">
    <!-- Transactions List -->
    <div class="transactions-list">
      <div class="transactions-header">
        <div class="th-id">Transaction ID</div>
        <div class="th-date">Date</div>
        <div class="th-amount">Amount</div>
        <div class="th-units">Units</div>
        <div class="th-status">Status</div>
        <div class="th-actions">Actions</div>
      </div>
      <div class="transactions-body">
        <div *ngFor="let transaction of filteredTransactions" 
             class="transaction-row" 
             (click)="selectTransaction(transaction)">
          <div class="td-id">{{ transaction.id }}</div>
          <div class="td-date">{{ transaction.created_at | date: 'short' }}</div>
          <div class="td-amount">{{ transaction.amount | currency:'TSh':'symbol':'1.2-2' }}</div>
          <div class="td-units">{{ transaction.units_purchased }} kWh</div>
          <div class="td-status" [ngClass]="{
            'status-completed': transaction.status === 'Completed',
            'status-pending': transaction.status === 'Pending',
            'status-failed': transaction.status === 'Failed'
          }">
            <span class="status-icon" [innerHTML]="getStatusIcon(transaction.status)"></span>
            {{ transaction.status }}
          </div>
          <div class="td-actions">
            <button class="view-details-btn" (click)="selectTransaction(transaction); $event.stopPropagation()">
              <span class="icon">👁️</span> View Details
            </button>
            <button class="download-btn" (click)="downloadReceipt(transaction); $event.stopPropagation()">
              <span class="icon">📄</span> Receipt
            </button>
          </div>
        </div>
        
        <div *ngIf="!isLoading && filteredTransactions.length === 0" class="no-transactions">
          <div class="empty-state">
            <div class="empty-icon">📋</div>
            <h3>No transactions found</h3>
            <p>{{ searchText || statusFilter !== 'all' ? 'Try adjusting your search or filter criteria.' : 'You haven\'t made any transactions yet.' }}</p>
            <button class="refresh-btn" (click)="refreshTransactions()">
              <span class="icon">🔄</span> Refresh
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Transaction summary stats -->
  <div class="transaction-stats" *ngIf="!isLoading && transactions.length > 0">
    <div class="stat-card">
      <div class="stat-number">{{ transactions.length }}</div>
      <div class="stat-label">Total Transactions</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">{{ getCompletedCount() }}</div>
      <div class="stat-label">Completed</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">{{ getPendingCount() }}</div>
      <div class="stat-label">Pending</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">TSh {{ getTotalAmount() | currency:'TSh':'symbol':'1.2-2' }}</div>
      <div class="stat-label">Total Amount</div>
    </div>
  </div>
</div>
