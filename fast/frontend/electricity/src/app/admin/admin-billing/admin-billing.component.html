<div class="admin-billing-container">
  <div class="page-header">
    <h1>Billing Management</h1>
    <p>Manage customer bills and payment tracking</p>
  </div>

  <!-- Summary Cards -->
  <div class="summary-cards">
    <div class="summary-card">
      <h3>Total Revenue</h3>
      <p class="amount">TSh {{ totalAmount | currency:'TSh':'symbol':'1.2-2' }}</p>
    </div>
    <div class="summary-card">
      <h3>Total Transactions</h3>
      <p class="amount">{{ totalTransactions }}</p>
    </div>
    <div class="summary-card">
      <h3>Avg. Transaction Value</h3>
      <p class="amount">TSh {{ averageTransactionValue | currency:'TSh':'symbol':'1.2-2' }}</p>
    </div>
  </div>

  <!-- Search and Filter Section -->
  <div class="search-section">
    <div class="search-bar">
      <input 
        type="text" 
        placeholder="Search transactions by reference or user name..." 
        [(ngModel)]="searchTerm"
        (keyup.enter)="searchBills()">
      <select [(ngModel)]="selectedStatus" (change)="filterByStatus()">
        <option value="all">All Status</option>
        <option value="completed">Completed</option>
        <option value="pending">Pending</option>
        <option value="failed">Failed</option>
      </select>
      <button class="search-btn" (click)="searchBills()">Search</button>
    </div>
  </div>

  <!-- Bills Table -->
  <div class="bills-table-container">
    <table class="bills-table">
      <thead>
        <tr>
          <th>Transaction Ref</th>
          <th>User Name</th>
          <th>Amount</th>
          <th>Units Purchased</th>
          <th>Date</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let bill of filteredBills | slice: (currentPage - 1) * 10 : currentPage * 10">
          <td>{{ bill.transaction_reference }}</td>
          <td>{{ bill.username || bill.user_full_name }}</td>
          <td>TSh {{ bill.amount | currency:'TSh':'symbol':'1.2-2' }}</td>
          <td>{{ bill.units_purchased }} kWh</td>
          <td>{{ bill.created_at | date:'short' }}</td>
          <td>
            <span class="status-badge" 
                  [ngClass]="bill.status">
              {{ bill.status }}
            </span>
          </td>
          <td>
            <button class="action-btn view" (click)="viewBillDetails(bill)">View</button>
            <!-- Edit and Remind actions might need specific API endpoints or logic -->
            <!-- <button class="action-btn edit" (click)="editBill(bill)">Edit</button> -->
            <!-- <button class="action-btn reminder" *ngIf="bill.status !== 'completed'" (click)="sendReminder(bill)">Remind</button> -->
          </td>
        </tr>
        <tr *ngIf="filteredBills.length === 0">
          <td colspan="7" class="no-data">
            No billing transactions found.
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Pagination -->
    <div class="pagination">
      <button [disabled]="currentPage === 1" (click)="goToPage(currentPage - 1)">Previous</button>
      <span>Page {{ currentPage }} of {{ totalPages }}</span>
      <button [disabled]="currentPage === totalPages" (click)="goToPage(currentPage + 1)">Next</button>
    </div>
  </div>
</div>
